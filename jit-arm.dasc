/* JIT for Brainf*ck */

#include <stdint.h>
#include "util.h"

|.arch arm
|.actionlist actions


#define Dst &state
#define MAX_NESTING 256

int main(int argc, char *argv[]) {
  if (argc < 2) err("Usage: jit-arm <inputfile>");
  dasm_State *state;
  initjit(&state, actions);

  // Function prologue.
  | mov r1, #1

  // Function epilogue.
  | bx lr

  int (*fptr)() = jitcode(&state);

  // TODO: find segmuentfult reason
  fptr();

  free_jitcode(fptr);
  return 0;
}
